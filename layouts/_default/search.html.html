{{ define "title" }}
  Search &ndash; {{ .Site.Title }}
{{ end }}
{{ define "main" }}
  <div id="search-results">

  </div>
  <template id="search-result-template">
    <p><a href="#"></a></p>
  </template>
  {{/* TODO better way to load lunr script? inline this? */}}
  <script src="/lunr.js" type="text/javascript"></script>
  <script type="text/javascript">
    const idxP = fetch('/lunr-index.json')
      .then(response => response.json()) // TODO: error handling
      .then(data => lunr.Index.load(data));
    // TODO: is DOMContentLoaded needed here?
    idxP.then(idx => {
      const resultsElem = document.getElementById('search-results');
      for (let result of idx.search('place influence')) {
        const resultElem = createResultElem(result.ref, result.ref);
        resultsElem.appendChild(resultElem);
      }
    });
    function createResultElem(url, name) {
      const resultElem = document.getElementById('search-result-template').content.cloneNode(true);
      resultElem.querySelector('a').href = url;
      resultElem.querySelector('a').textContent = name;
      return resultElem;
    }
  </script>
{{ end }}
